{% extends "base.html" %}

{% block title %}Beállítások{% endblock %}

{% block head %}
 <script>
    function validatePassword() {
        const password = document.getElementById('new_password').value;
        const passwordAgain = document.getElementById('new_password_again').value;
        const messageElement = document.getElementById('passwordMatchMessage');
        const submit = document.getElementById('submit');

        if (!passwordAgain) {
            messageElement.textContent = "";
            submit.disabled = true;
        }
        else if (password === passwordAgain) {
            messageElement.textContent = "A jelszavak egyeznek.";
            messageElement.className = "text-success";
            submit.disabled = false;
        } else {
            messageElement.textContent = "A jelszavak nem egyeznek.";
            messageElement.className = "text-danger";
            submit.disabled = true;
        }
    }
    </script>
{% endblock %}

{% block heading %}<h2 class="text-center mb-3 pt-4">Beállítások</h2>{% endblock %}

{% block main %}
    <form method="post" class="form" action="{{ url_for('users.user_settings') }}">
        {{ user_settings_form.csrf_token() }}

        <div class="form-group mb-3">
            {{ user_settings_form.name.label }}
            {{ user_settings_form.name(class="form-control") }}
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-dark"><i class="fa-solid fa-floppy-disk"></i> {{ user_settings_form.submit.label }}</button>
        </div>
    </form>

    <br>
    <br>

    <form method="post" class="form" action="{{ url_for('users.password_reset') }}">
        {{ user_password_form.csrf_token() }}
        <div class="form-group mb-1">
            <label for="old_password">{{ user_password_form.old_password.label }}</label>
            <div class="input-group">
                {{ user_password_form.old_password(class="form-control", id="old_password") }}
                <span class="show-password-btn ms-4 mt-1" style="font-size: 1.2em" onclick="togglePasswordVisibility('old_password', this);">
                    <i class="fa fa-eye-slash"></i>
                </span>
            </div>

            <label for="new_password">{{ user_password_form.new_password.label }}</label>
                <div class="input-group">
                    {{ user_password_form.new_password(class="form-control", id="new_password", onkeyup="validatePassword()") }}
                    <span class="show-password-btn ms-4 mt-1" style="font-size: 1.2em" onclick="togglePasswordVisibility('new_password', this); togglePasswordVisibility('new_password_again', this)">
                        <i class="fa fa-eye-slash"></i>
                    </span>
                </div>
            </div>
            <div class="form-group mb-1">
                <label for="new_password_again">{{ user_password_form.new_password_again.label }}</label>
                {{ user_password_form.new_password_again(class="form-control", id="new_password_again", onkeyup="validatePassword()") }}
            </div>
            <div class="match" id="passwordMatchMessage"></div>

        <div class="form-group">
            <button type="submit" class="btn btn-dark" id="submit"><i class="fa-solid fa-floppy-disk"></i> {{ user_password_form.submit.label }}</button>
        </div>
    </form>


    <form method="post" action="{{ url_for('users.delete_self') }}">
    {{ user_delete_form.csrf_token() }}
    <button type="submit" class="btn btn-primary-dark">{{ user_delete_form.submit.label }}</button>
    </form>

{% endblock %}